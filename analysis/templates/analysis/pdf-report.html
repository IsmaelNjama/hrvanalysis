{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@100&display=swap" rel="stylesheet">
    <title>HRVSCIHUB_REPORT_{% now "jS F Y H:i" %}</title>
    <style>

        .container {
            display: flex;
            background-color: #F0F7D4;
        }

        .container-item {
            flex: 1;
        }

        .container-item:first-child {
            margin-right: 5px;
        }

        .info {
            background-color: #347B98;
            color: #F0F7D4;
        }

        h4 {
            color: #092834;
        }

        h5 {
            color: #00CFDD;
        }

        table {
            border-collapse: collapse;
            width: 100%;
        }

        th,
        td {
            padding: 0.25rem;
            text-align: left;
            border: 1px solid #ccc;
        }

        tbody tr:nth-child(odd) {
            background: #eee;
        }

        tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        .text-uppercase {
            text-transform: uppercase;
        }

        .mb-3 {
            margin-bottom: 5px;
        }

        .text-center {
            text-align: center;
        }

        .table-sm {
            height: 50px;
        }
    </style>
</head>

<body>
    <header>

        <div class="container">

            <div class="container-item" style="padding: 10px;">
                <img src="static\assets\images\logo.png" height="50px">
                <span>{% now "jS F Y H:i" %}</span>
            </div>

        </div>
        <hr>
    </header>
    <div>
        <h1 class="display-4 text-info">HRV Analysis Results</h1>
    </div>
    <section>
        <h4>General information</h4>
        <div class="container info" >

            <div class="container-item" style="padding: 10px;">
                <p>Subject: {{result.sample.subject.name}}
                    <br>Age: {{result.sample.subject.age}} years old<br>
                    Gender: {{result.sample.subject.gender}}
                </p>
            </div>

            <div class="container-item" style="padding: 10px;">
                <p>comment: {{result.sample.comment}}</p>
            </div>

        </div>
        <div class="container">
            {{ result.tachogram_plot|safe }}
        </div>
    </section>

    <section>
        <h4>Time domain results</h4>
        <div class="mb-3">
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">Parameter</th>
                        <th scope="col">Unit</th>
                        <th scope="col">Value</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>NNI</td>
                        <td>-</td>
                        <td>{{ result.parameters.nni_counter|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <td>NNI MEAN</td>
                        <td>ms</td>
                        <td>{{ result.parameters.nni_mean|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <td>NNI MIN</td>
                        <td>ms</td>
                        <td>{{ result.parameters.nni_min|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <td>NNI MAX</td>
                        <td>ms</td>
                        <td>{{ result.parameters.nni_max|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <td>HR MEAN</td>
                        <td>bpm</td>
                        <td>{{ result.parameters.hr_mean|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <td>HR MIN</td>
                        <td>bpm</td>
                        <td>{{ result.parameters.hr_min|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <td>HR MAX</td>
                        <td>bpm</td>
                        <td>{{ result.parameters.hr_max|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <td>HR STD</td>
                        <td>bpm</td>
                        <td>{{ result.parameters.hr_std|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <td>NNI DIFF MEAN</td>
                        <td>ms</td>
                        <td>{{ result.parameters.nni_diff_mean|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <td>NNI DIFF MIN</td>
                        <td>ms</td>
                        <td>{{ result.parameters.nni_diff_min|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <td>NNI DIFF MAX</td>
                        <td>ms</td>
                        <td>{{ result.parameters.nni_diff_max|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <td>SDNN</td>
                        <td>ms</td>
                        <td>{{ result.parameters.sdnn|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <td>SDNN INDEX</td>
                        <td>ms</td>
                        <td>{{ result.parameters.sdnn_index|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <td>SDANN</td>
                        <td>ms</td>
                        <td>{{ result.parameters.sdann|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <td>RMSSD</td>
                        <td>ms</td>
                        <td>{{ result.parameters.rmssd|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <td>SDSD</td>
                        <td>ms</td>
                        <td>{{ result.parameters.sdsd|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <td>NN50</td>
                        <td>-</td>
                        <td>{{ result.parameters.nn50|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <td>PNN50</td>
                        <td>-</td>
                        <td>{{ result.parameters.pnn50|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <td>NN20</td>
                        <td>-</td>
                        <td>{{ result.parameters.nn20|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <td>PNN20</td>
                        <td>-</td>
                        <td>{{ result.parameters.pnn20|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <td>TRIANGULAR INDEX</td>
                        <td>-</td>
                        <td>{{ result.parameters.tri_index|floatformat:3|intcomma }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="mb-3">
            <h5>Custom threshold</h5>
            <table>
                <thead>
                    <tr>
                        <th scope="col">parameter</th>
                        <th scope="col">value</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>{{ custom_threshold.2 }}</td>
                        <td>{{ custom_threshold.3 }}</td>
                    </tr>
                    <tr>
                        <td>{{ custom_threshold.0 }}</td>
                        <td>{{ custom_threshold.1 }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="container" id="hist-chart">
            {{ result.nn_histogram|safe}}
        </div>
    </section>

    <section>
        <h4>Frequency domain results</h4>
        <div class="mb-3">
            <h5>Welch's Method</h5>
            <table class="table">
                <thead>
                    <tr class="text-uppercase">
                        <th scope="col">parameter</th>
                        <th scope="col">unit</th>
                        <th scope="col">vlf</th>
                        <th scope="col">lf</th>
                        <th scope="col">hf</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th scope="row">Peak Frequencies</th>
                        <td>Hz</td>
                        <td>{{ result.parameters.fft_peak.0|floatformat:3|intcomma }}</td>
                        <td>{{ result.parameters.fft_peak.1|floatformat:3|intcomma }}</td>
                        <td>{{ result.parameters.fft_peak.2|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Absolute Powers</th>
                        <td>ms2</td>
                        <td>{{ result.parameters.fft_abs.0|floatformat:3|intcomma }}</td>
                        <td>{{ result.parameters.fft_abs.1|floatformat:3|intcomma }}</td>
                        <td>{{ result.parameters.fft_abs.2|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Relative Powers</th>
                        <td>%</td>
                        <td>{{ result.parameters.fft_rel.0|floatformat:3|intcomma }}</td>
                        <td>{{ result.parameters.fft_rel.1|floatformat:3|intcomma }}</td>
                        <td>{{ result.parameters.fft_rel.2|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Logarithmic Powers</th>
                        <td>-</td>
                        <td>{{ result.parameters.fft_log.0|floatformat:3|intcomma }}</td>
                        <td>{{ result.parameters.fft_log.1|floatformat:3|intcomma }}</td>
                        <td>{{ result.parameters.fft_log.2|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <th scope="row">LF/HF Ratio</th>
                        <td colspan="4">{{ result.parameters.fft_ratio|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Total Power</th>
                        <td>ms2</td>
                        <td colspan="3">{{ result.parameters.fft_total|floatformat:3|intcomma }}</td>
                    </tr>
                </tbody>
            </table>
            <p>Configurations: </p>
            <ul>
                <li>Resampling frequency: {{ result.parameters.fft_resampling_frequency|floatformat:3|intcomma }} Hz</li>
                <li>Interpolation: {{ result.parameters.fft_interpolation }}</li>
                <li>Window: {{ result.parameters.fft_window }}</li>
                <li>NFFT (over entire signal): {{ result.parameters.fft_nfft|floatformat:3|intcomma }}</li>
            </ul>
        </div>

        <div>
            <h5 class="text-center">Lomb-Scargle Method</h5>
            <table class="table table-bordered text-uppercase">
                <thead>
                    <tr class="text-uppercase">
                        <th scope="col">parameter</th>
                        <th scope="col">unit</th>
                        <th scope="col">vlf</th>
                        <th scope="col">lf</th>
                        <th scope="col">hf</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th scope="row">Peak Frequencies</th>
                        <td>Hz</td>
                        <td>{{ result.parameters.lomb_peak.0|floatformat:3|intcomma }}</td>
                        <td>{{ result.parameters.lomb_peak.1|floatformat:3|intcomma }}</td>
                        <td>{{ result.parameters.lomb_peak.2|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Absolute Powers</th>
                        <td>ms2</td>
                        <td>{{ result.parameters.lomb_abs.0|floatformat:3|intcomma }}</td>
                        <td>{{ result.parameters.lomb_abs.1|floatformat:3|intcomma }}</td>
                        <td>{{ result.parameters.lomb_abs.2|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Relative Powers</th>
                        <td>%</td>
                        <td>{{ result.parameters.lomb_rel.0|floatformat:3|intcomma }}</td>
                        <td>{{ result.parameters.lomb_rel.1|floatformat:3|intcomma }}</td>
                        <td>{{ result.parameters.lomb_rel.2|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Logarithmic Powers</th>
                        <td>-</td>
                        <td>{{ result.parameters.lomb_log.0|floatformat:3|intcomma }}</td>
                        <td>{{ result.parameters.lomb_log.1|floatformat:3|intcomma }}</td>
                        <td>{{ result.parameters.lomb_log.2|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <th scope="row">LF/HF Ratio</th>
                        <td colspan="4">{{ result.parameters.lomb_ratio|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Total Power</th>
                        <td>ms2</td>
                        <td colspan="3">{{ result.parameters.lomb_total|floatformat:3|intcomma }}</td>
                    </tr>
                </tbody>
            </table>
            <p>Configurations: </p>
            <ul>
                <li>Moving Average Window Size: {{ result.parameters.lomb_ma }} Hz</li>
                <li>NFFT (over entire signal): {{ result.parameters.lomb_nfft|floatformat:3|intcomma }}</li>
            </ul>
        </div>

        <div class="mb-3">
            <h5 class="text-center text-info">Selected Frequency Bands</h5>
            <table class="table" style="color: #F0F7D4;">
                <tbody>
                    <tr style="background-color: #66B032;">
                        <th scope="row">VLF Band</th>
                        <td>Hz</td>
                        <td>{{result.parameters.lomb_bands.vlf.0|floatformat:3|intcomma}}-{{result.parameters.lomb_bands.vlf.1|floatformat:3|intcomma}}</td>
                    </tr>
                    <tr style="background-color: #347B98;">
                        <th scope="row">LF Band</th>
                        <td>Hz</td>
                        <td>{{result.parameters.lomb_bands.lf.0|floatformat:3|intcomma}}-{{result.parameters.lomb_bands.lf.1|floatformat:3|intcomma}}</td>
                    </tr>
                    <tr style="background-color: #092834;">
                        <th scope="row">HF Band</th>
                        <td>Hz</td>
                        <td>{{result.parameters.lomb_bands.hf.0|floatformat:3|intcomma}}-{{result.parameters.lomb_bands.hf.1|floatformat:3|intcomma}}</td>
                    </tr>

                </tbody>
            </table>
        </div>

        <div>
            <div>
                {{ result.fft_plot|safe }}
            </div>
            <div>
                {{ result.lomb_plot|safe }}
            </div>            
        </div>


    </section>


    <section>
        <br>
        <br>        
        <div class="mb-3">
            <h4>Nonlinear result.Parameters</h4>
            <h5 class="text-center text-info">Poincare Plot result.Parameters</h5>
            <table class="table table-bordered text-uppercase">
                <thead>
                    <tr>
                        <th scope="col">parameter</th>
                        <th scope="col">value</th>
                        <th scope="col">unit</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>SD1</td>
                        <td>ms</td>
                        <td>{{ result.parameters.sd1|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <td>SD2</td>
                        <td>ms</td>
                        <td>{{ result.parameters.sd2|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <td>SD1/SD2</td>
                        <td>-</td>
                        <td>{{ result.parameters.sd_ratio|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <td>Ellipse Area S</td>
                        <td>-</td>
                        <td>{{ result.parameters.ellipse_area|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <td>Sample Entropy</td>
                        <td>-</td>
                        <td>{{ result.parameters.sampen|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <td>DFA alpha 1</td>
                        <td>-</td>
                        <td>{{ result.parameters.dfa_alpha1|floatformat:3|intcomma }}</td>
                    </tr>
                    <tr>
                        <td>DFA alpha 2</td>
                        <td>-</td>
                        <td>{{ result.parameters.dfa_alpha2|floatformat:3|intcomma }}</td>
                    </tr>
                </tbody>
            </table>
        </div>



        <div style="display: inline-block;">
            <div style="float:left; width: 350px;">
                {{ result.poincare_plot|safe}}
            </div>

            <div style="float:left; width: 350px;margin-left: 10px;">
                {{ result.dfa_plot|safe}}
            </div>
        </div>
    </section>

    {% if result.radar_plot %}
    <section>
        <div class="container">
            {{ result.radar_plot|safe }}
        </div>
    </section>
    {% endif %}
    <section>
        <h5>Glossary</h5>
        <ul>
            <li>BPM &nbsp;Beats per Minute</li>
            <li>DFA &nbsp;Detrended Fluctuation Analysis</li>
            <li>HF &nbsp;High Frequency Band</li>
            <li>HR &nbsp;Hear Rate</li>
            <li>LF &nbsp;Low Frequency Band</li>
            <li>NNI &nbsp;DiFF Differences between successive NNI</li>
            <li>NNI &nbsp;Normal-to-Normal Intervals</li>
            <li>pNNx &nbsp;NNx / # of NNI</li>
            <li>PSD &nbsp;Power Spectral Density</li>
            <li>RMSSD &nbsp;Root Mean of Squared Difference NNI</li>
            <li>SDANN &nbsp;Standard Deviation of the Mean of NNI in all 5 minute Segments</li>
            <li>SDNN &nbsp;Standard Deviation of NNI</li>
            <li>SDNN index &nbsp;Standard Deviation of the Mean of NN Intervals in all 5 minute Segments</li>
            <li>SDSD &nbsp;Standard Deviation of Difference NNI</li>
            <li>TINN &nbsp;Triangular Interpolation of the NNI Histogram</li>
            <li>VLF &nbsp;Very Low Frequency Band</li>
        </ul>
        <div style="background-color: #347B98; padding: 10px;">
            <h4 style="color: #F0F7D4;">Generated with HRVSciHub {% now "jS F Y H:i" %}</h4>
        </div>
        
    </section>
</body>

</html>