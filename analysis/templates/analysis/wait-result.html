{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container-fluid p-0">
    <div class="page-title">
        <div class="row">
            <div class="col-12 col-md-6 order-md-1 order-last"></div>
            <div class="col-12 col-md-6 order-md-2 order-first">
                <nav aria-label="breadcrumb" class='breadcrumb-header'>
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{% url 'subject_list' %}">Home</a></li>
                        <li class="breadcrumb-item"><a href="{% url 'subject_sample_list' sample.subject.pk %}">Subject</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Sample</li>
                    </ol>
                </nav>
            </div>
        </div>

    </div>
    <div id="headline" class="container text-center">
        <div class="spinner-grow m-3" style="width: 3rem; height: 3rem;" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <h4 class='title'>We are running analysis and will let you know once it is completed</h4>
        <p>{{ sample.comment }}</p>
    </div>
    <div class="container">
        {% if data %}
        <div id="data-preview" class="table-responsive mb-3">

            <div class="container">
                {{ data|safe }}
            </div>

        </div>
        {% endif %}
    </div>

</div>
<script>
    isReady ()
    // check result computation status
    function isReady () {
        let url = "{% url 'result-detail' sample.pk %}";
        let analysis_board_url = "{% url 'analysis_board' sample.pk %}"
        let headline = document.getElementById('headline');
        fetch(url).then(resp => {
            if (resp.status == 200) {
                headline.innerHTML = `
                <h4 class='title mt-5'>Analysis completed successfully</h4>
                <div class="container">
                    <div>
                        <a class="btn btn-sm btn-primary mt-2" href="${analysis_board_url}"> Go To Results </a>
                    </div>
                </div>
                `
            }
        }).catch((exception) => {
            console.log(exception);
        });
    }  
</script>
{% endblock content %}